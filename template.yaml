AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

# More info about Globals: https://github.com/awslabs/serverless-application-model/blob/master/docs/globals.rst
Globals:
  Function:
    Timeout: 5
    Handler: handler
    Runtime: go1.x
    Architectures:
      - x86_64
    Tracing: Active

Resources:
  UserManagement:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: user_management/
      Policies:
        DynamoDBCrudPolicy:
          TableName: Fitbit
      Events:
        SignUp:
          Type: Api
          Properties:
            Path: /signup
            Method: Post
        RenderSignup:
          Type: Api
          Properties:
            Path: /signup
            Method: Get
        RenderLogin:
          Type: Api
          Properties:
            Path: /login
            Method: Get
        Login:
          Type: Api
          Properties:
            Path: /login
            Method: Post


  ProfileManagement:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: profile/
      Policies:
        DynamoDBCrudPolicy:
          TableName: Fitbit
      Events:
        ReadProfile:
          Type: Api
          Properties:
            Path: /profile/{username}
            Method: Get
        UpdateProfile:
          Type: Api
          Properties:
            Path: /profile/{username}
            Method: Post


  TermsOfService:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: terms/
      Events:
        CatchAll:
          Type: Api # More info about API Event Source: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#api
          Properties:
            Path: /terms
            Method: GET

  LandingPage:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: application_website/
      Events:
        CatchAll:
          Type: Api # More info about API Event Source: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#api
          Properties:
            Path: /
            Method: GET

  Oauth:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: webhook_oauth/
      Policies:
        DynamoDBCrudPolicy:
          TableName: Fitbit
      Events:
        GetCode:
          Type: Api # More info about API Event Source: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#api
          Properties:
            Path: /auth_code
            Method: GET
        Token:
          Type: Api
          Properties:
            Path: /webhook
            Method: GET

  PrivacyPolicy:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: privacy/
      Events:
        CatchAll:
          Type: Api # More info about API Event Source: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#api
          Properties:
            Path: /privacy
            Method: GET

  WebhookData:
    Type: AWS::Serverless::Function # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
    Properties:
      CodeUri: webhook_data/
      Events:
        CatchAll:
          Type: Api # More info about API Event Source: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#api
          Properties:
            Path: /webhook_data
            Method: POST
        GetRequest:
          Type: Api
          Properties:
            Path: /webhook_data
            Method: GET
